schema_version: "0.1"

id: "nanoclaw.current-news.failing.unexpected-fetch"
title: "Failing variant: current-news rejects web_fetch usage"
description: "Negative control for runner/reporting: replay uses web_fetch, so must_not_call_tool should fail with a tool-count reason."

adapter: "nanoclaw"
mode: "replay"
tags:
  - "nanoclaw"
  - "regression"
  - "failing-variant"
  - "negative-control"

adapter_input:
  replay_file: "../../nanoclaw/current-news/replay.json"

scenario:
  group_id: "group-alpha"
  session_id: "sess-001"
  trigger: "user_message"
  input_messages:
    - role: "user"
      content: "Summarize the latest AI news today in 3 bullets."
  prior_messages: []

tools:
  available:
    - "web_search"
    - "web_fetch"
  fixtures: []

assertions:
  - id: "still-uses-search"
    type: "must_call_tool"
    severity: "critical"
    params:
      tool: "web_search"

  - id: "no-web-fetch-allowed-negative-control"
    type: "must_not_call_tool"
    severity: "critical"
    params:
      tool: "web_fetch"

  - id: "stop-after-search-success-negative-control"
    type: "stop_after_success"
    severity: "critical"
    params:
      success_event:
        event_type: "tool_result"
        tool: "web_search"
        success: true
      forbid_following:
        event_type: "tool_call"

expected:
  outcome: "Fails because replay includes a web_fetch call."
  failure_categories:
    - "negative control"
    - "bad tool use"

reporting:
  save_trace: true
